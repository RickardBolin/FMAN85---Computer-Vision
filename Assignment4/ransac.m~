function [bestParameter1,bestParameter2,bestParameter3] = ransac(data,num,iter,threshDist,inlierRatio)
 % data: a 2xn dataset with #n data points
 % num: the minimum number of points. For line fitting problem, num=2
 % iter: the number of iterations
 % threshDist: the threshold of the distances between points and the fitting line
 % inlierRatio: the threshold of the number of inliers 
 
 % Plot the data points
 figure; scatter3(data(1,:),data(2,:),data(3,:));hold on;
 n_points = size(data,2); % Total number of points
 bestInNum = 0; % Best fitting line with largest number of inliers
 bestParameter1=0;bestParameter2=0;bestParameter3=0; % parameters for best fitting line
 for i=1:iter
 % Randomly select 3 points
     idx = randperm(n_points,num); sample = data(:,idx);   
 % Compute the distances between all points with the fitting line
     plane = null (data (: , idx ));
     plane = plane ./ norm ( plane (1:3));
     distance = normVector*(data - repmat(sample(:,1),1,n_points));
     inliers = abs ( plane â€™* X ) <= 0.1
 % Compute the inliers with distances smaller than the threshold
     inlierIdx = find(abs(distance)<=threshDist);
     inlierNum = length(inlierIdx);
 % Update the number of inliers and fitting model if better model is found     
     if inlierNum>=round(inlierRatio*n_points) && inlierNum>bestInNum
         bestInNum = inlierNum;         
         bestParameter1=normVector(1); bestParameter2=normVector(2); bestParameter3=normVector(3);
     end
 end
 
 % Plot the best fitting plane
 syms x y
 z = (bestParameter1*x+bestParameter2*y+1)/bestParameter3;
 fmesh(z)
 
end